@startuml
!theme blueprint
skinparam backgroundColor #F8F9FA
skinparam activity {
    BackgroundColor #E3F2FD
    BorderColor #1976D2
    FontColor #1565C0
    FontSize 11
    FontName Arial
}
skinparam activityDiamond {
    BackgroundColor #FFF3E0
    BorderColor #F57C00
    FontColor #E65100
}
skinparam partition {
    BackgroundColor #FAFAFA
    BorderColor #757575
    FontColor #424242
    FontSize 12
    FontStyle bold
}
skinparam note {
    BackgroundColor #E8F5E8
    BorderColor #4CAF50
    FontColor #2E7D32
    FontSize 10
}

title <size:16><b>SƠ ĐỒ HOẠT ĐỘNG CẬP NHẬT THÔNG TIN KHÁCH HÀNG</b></size>

|#LightBlue|**KHÁCH HÀNG**|
start
:Đăng nhập vào\nứng dụng Mobile Banking;
note right
Khách hàng đã có
tài khoản hợp lệ
end note

:Vào mục Setting\ntrên menu chính;

:Chọn Profile\nđể cập nhật thông tin;

:Xem thông tin\nhiện tại;

:Chỉnh sửa thông tin\ncần cập nhật\n(Địa chỉ, SĐT, Email, v.v.);

if (Có upload\ngiấy tờ mới?) then (Có)
    :Upload giấy tờ\nbổ sung/cập nhật\n(CCCD mới, hóa đơn địa chỉ);
else (Không)
endif

:Xác nhận cập nhật\nthông tin;

|#LightGreen|**MOBILE APP**|
:Hiển thị màn hình\nSetting - Profile;

:Load thông tin khách hàng\nhiện tại từ cache/server;

:Cho phép chỉnh sửa\ncác trường thông tin;

:Validate dữ liệu\ntrên client side\n(Format, bắt buộc);

if (Validation thành công?) then (Có)
    if (Có file upload?) then (Có)
        :Xử lý file upload\n(Compress, format);
    else (Không)
    endif

    :Gọi API Backbase\n(Update Customer Profile);
else (Không)
    :Hiển thị lỗi validation\ncho khách hàng;

    |#LightBlue|**KHÁCH HÀNG**|
    :Sửa lại thông tin\ntheo yêu cầu;

    |#LightGreen|**MOBILE APP**|
    :Validate lại dữ liệu;
endif

|#LightYellow|**BACKBASE BACKEND**|
:Nhận request cập nhật\nthông tin từ Mobile App;

:Xác thực session\nvà quyền truy cập;

:Validate business rules\n(Định dạng, logic nghiệp vụ);

if (Business validation OK?) then (Có)
    :Chuẩn bị dữ liệu\ncho Customer Master;

    :Gọi API Customer Master\n(Update Customer Info);
else (Không)
    :Trả lỗi business\ncho Mobile App;

    |#LightGreen|**MOBILE APP**|
    :Hiển thị lỗi\nnghiệp vụ;

    |#LightBlue|**KHÁCH HÀNG**|
    :Xem thông báo lỗi\nvà thực hiện lại;
    stop
endif

|#LightPink|**CUSTOMER MASTER**|
:Nhận request cập nhật\nthông tin khách hàng;

:Kiểm tra CIF\ntồn tại và hợp lệ;

if (CIF hợp lệ?) then (Có)
    if (Có thay đổi\nthông tin quan trọng?) then (Có)
        :Thực hiện re-KYC\n(Kiểm tra giấy tờ mới,\nWatchlist screening);

        if (Re-KYC thành công?) then (Có)
            :Cập nhật thông tin\nvào database;

            :Ghi log audit trail\n(Ai, cập nhật gì, khi nào);

            :Trả kết quả thành công\ncho Backbase;
        else (Không)
            :Trả lỗi KYC\ncho Backbase;

            |#LightYellow|**BACKBASE BACKEND**|
            :Xử lý lỗi KYC;

            :Trả thông báo lỗi\ncho Mobile App;

            |#LightGreen|**MOBILE APP**|
            :Hiển thị lỗi\nKYC cho khách hàng;

            |#LightBlue|**KHÁCH HÀNG**|
            :Xem lỗi và\nliên hệ hỗ trợ;
            stop
        endif
    else (Không)
        :Cập nhật thông tin\nvào database\n(Không cần re-KYC);

        :Ghi log audit trail;

        :Trả kết quả thành công\ncho Backbase;
    endif
else (Không)
    :Trả lỗi CIF\nkhông tồn tại;

    |#LightYellow|**BACKBASE BACKEND**|
    :Xử lý lỗi CIF;
    stop
endif

|#LightYellow|**BACKBASE BACKEND**|
:Nhận kết quả\ntừ Customer Master;

:Cập nhật cache/session\nvới thông tin mới;

:Trả kết quả\ncho Mobile App;

|#LightGreen|**MOBILE APP**|
:Nhận kết quả\ntừ Backbase;

:Cập nhật cache\nlocal storage;

:Hiển thị thông báo\n"Cập nhật thành công";

:Refresh màn hình Profile\nvới thông tin mới;

|#LightBlue|**KHÁCH HÀNG**|
:Xem xác nhận\ncập nhật thành công;

:Sử dụng tiếp\nứng dụng với\nthông tin đã cập nhật;

stop

@enduml